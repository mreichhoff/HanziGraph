!function(){"use strict";const e=document.getElementById("search-form"),n=document.getElementById("hanzi-box"),t=document.getElementById("walkthrough"),a=document.getElementById("examples");document.getElementById("graph-container");const o=document.getElementById("graph");let i={},l={},r={},c={};const s=document.getElementById("left-menu-button-container"),u=document.getElementById("left-menu-button"),d=document.getElementById("main-app-container"),m=document.getElementById("menu-container"),h=[d,m],p={main:{leftButtonClass:"menu-button",activeContainer:d,leftState:"menu",animation:"slide-in"},menu:{leftButtonClass:"exit-button",activeContainer:m,statePreserving:!0,leftState:"previous",animation:"slide-in"}};let f=null,g="main";function y(){N&&N.style(T())}let w=null;function v(e){let n={nodes:[],edges:[]},t=[{word:e,path:[e]}];for(;t.length>0;){let e=t.shift();n.nodes.push({data:{id:e.path.join(""),word:e.word,depth:e.path.length-1,path:e.path}});for(const a of l[e.word].components)n.edges.push({data:{id:"_edge"+e.path.join("")+a,source:e.path.join(""),target:e.path.join("")+a}}),t.push({word:a,path:[...e.path,a]})}return n}function C(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85,directed:!0}}function x(e){return e in i&&i[e].length?i[e][0].pinyin[i[e][0].pinyin.length-1]:"5"}function E(e){const n=window.matchMedia("(prefers-color-scheme: dark)").matches;return"5"!==x(e.data("word"))||n?"black":"white"}function L(e){const n=window.matchMedia("(prefers-color-scheme: dark)").matches,t=x(e.data("word"));return"1"===t?"#ff635f":"2"===t?"#7aeb34":"3"===t?"#de68ee":"4"===t?"#68aaee":n?"#888":"#000"}function b(e){return e.substring(0,e.length-1)}const j=["b","p","m","f","d","t","n","l","g","k","h","z","c","s","zh","ch","sh","r","j","q","x"].sort(((e,n)=>n.length-e.length)),k=["a","o","e","ai","ei","ao","ou","an","ang","en","eng","ong","u","ua","uo","uai","ui","uan","uang","un","ueng","i","ia","ie","iao","iu","ian","iang","in","ing","iong","ü","üe","üan","ün"].sort(((e,n)=>n.length-e.length)),B={wu:[null,"u"],wa:[null,"ua"],wo:[null,"uo"],wai:[null,"uai"],wei:[null,"ui"],wan:[null,"uan"],wang:[null,"uang"],wen:[null,"un"],weng:[null,"ueng"],yi:[null,"i"],ya:[null,"ia"],ye:[null,"ie"],yao:[null,"iao"],you:[null,"iu"],yan:[null,"ian"],yang:[null,"iang"],yin:[null,"in"],ying:[null,"ing"],yong:[null,"iong"],yu:[null,"ü"],yue:[null,"üe"],yuan:[null,"üan"],yun:[null,"ün"],ju:["j","ü"],jue:["j","üe"],juan:["j","üan"],jun:["j","ün"],qu:["q","ü"],que:["q","üe"],quan:["q","üan"],qun:["q","ün"],xu:["x","ü"],xue:["x","üe"],xuan:["x","üan"],xun:["x","ün"]};function q(e){if("xx"===e)return[null,null];let n,t;if((e=e.replace("u:","ü"))in B)return B[e];for(const t of j)if(e.startsWith(t)){n=t;break}for(const n of k)if(e.endsWith(n)){t=n;break}return[n,t]}function I(e){const n=e.data("source")[e.data("source").length-1],t=e.data("target")[e.data("source").length],a=i[n],o=i[t];if(!a||!o)return"";for(const e of a.filter((e=>e.pinyin))){const n=b(e.pinyin.toLowerCase()),[t,a]=q(n),i=o.filter((e=>e.pinyin));for(const e of i){const t=b(e.pinyin.toLowerCase());if(t===n)return t}for(const e of i){const n=b(e.pinyin.toLowerCase()),[o,i]=q(n);if(o&&o===t)return`${o}-`;if(i&&i===a)return`-${i}`}}return""}function T(){let e=window.matchMedia("(prefers-color-scheme: dark)").matches;return[{selector:"node",style:{"background-color":L,label:"data(word)",color:E,"font-size":"20px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":e?"#666":"#121212","target-arrow-shape":"triangle","curve-style":"straight",color:"#fff","font-size":"12px","text-background-color":"#000","text-background-padding":"2px","text-background-opacity":"1","text-background-shape":"rectangle","text-events":"yes",width:"3px","arrow-scale":"0.65","target-arrow-color":e?"#aaa":"#121212",label:I}}]}let M=null,N=null;function z(e){M=e,o.innerHTML="",o.className="",M=e,N=cytoscape({container:o,elements:v(e),layout:C(e),style:T(),maxZoom:10,minZoom:.5}),N.on("tap","node",(function(e){_([...e.target.data("word")],a,!1)}))}function S(e,n){let t=document.createElement("span");t.className="sentence-container";let a=[];for(let n=0;n<e.length;n++)!function(e){let n=document.createElement("a");n.textContent=e,e in l&&(n.className="navigable"),n.addEventListener("click",(function(){e in l&&z(e)})),a.push(n),t.appendChild(n)}(e[n]);return n.appendChild(t),a}function $(e,n,t){let a=document.createElement("h2");a.classList.add("character-header");let o=document.createElement("span");o.textContent=e,o.classList.add("clickable"),o.classList.add(`tone${x(e)}`),a.appendChild(o),t&&a.classList.add("active"),o.addEventListener("click",(function(){a.classList.contains("active")||(document.querySelectorAll(".character-header").forEach((e=>e.classList.remove("active"))),a.classList.add("active")),z(e)})),n.appendChild(a)}function A(e,n){if(!(e in i))return;let t=document.createElement("ul");const a=i[e];for(let e=0;e<a.length;e++){let n=document.createElement("li");0!==e&&a[e].pinyin.toLowerCase()===a[e-1].pinyin.toLowerCase()||(n.classList.add("pronunciation"),n.classList.add(`tone${a[e].pinyin[a[e].pinyin.length-1]}`),n.textContent=a[e].pinyin.toLowerCase(),t.appendChild(n),n=document.createElement("li")),n.classList.add("definition"),n.innerText=a[e].en,t.appendChild(n)}n.appendChild(t)}function _(e,a,o){a.innerHTML="",t.style.display="none",P.style.display="none";let i=!0;if(!o){const t=e.join("");n.value=t;const a=`/components/${t}`;document.title=`${t} | Components`,history.pushState({word:t},"",a)}for(const n of e){let e=document.createElement("div");if(e.classList.add("character-data"),i){let n=document.createElement("p");n.classList.add("explanation"),n.innerText="Click any character for more information.",e.appendChild(n)}$(n,e,i),A(n,e),i=!1;let t=document.createElement("h3");t.innerText="Components",e.appendChild(t);let o=document.createElement("div");const s=l[n].components.join("");s?(o.className="target",S(s,o)):o.innerText="No components found. Maybe we can't break this down any more.",e.appendChild(o);let u=document.createElement("h3");u.innerText="Compounds",e.appendChild(u);let d=document.createElement("div");const m=l[n].componentOf.sort(((e,n)=>(e in r?r[e]:c[e]||1e4)-(n in r?r[n]:c[n]||1e4))).join("");m?(d.className="target",S(m,d)):d.innerText="This character is not a component of others.",e.appendChild(d),a.appendChild(e)}}function H(e,n){const t=e.filter((e=>e in l));t.length<1?P.removeAttribute("style"):(_(t,a,n),z(t[0]))}const P=document.getElementById("not-found-message");Promise.all([fetch("/data/components/components.json").then((e=>e.json())).then((e=>l=e)),fetch("/data/components/mandarin-defs.json").then((e=>e.json())).then((e=>i=e)),fetch("/data/simplified/character_freq_list.json").then((e=>e.json())).then((e=>{for(let n=0;n<e.length;n++)r[e[n]]=n})),fetch("/data/traditional/character_freq_list.json").then((e=>e.json())).then((e=>{for(let n=0;n<e.length;n++)c[e[n]]=n}))]).then((o=>{window.addEventListener("resize",(function(){clearTimeout(w),w=setTimeout((()=>{N&&N.layout(C(M)).run()}),1e3)})),window.onpopstate=e=>{const n=e.state;n&&n.word||(a.innerHTML="",t.removeAttribute("style")),H([...n.word],!0)},matchMedia("(prefers-color-scheme: dark)").addEventListener("change",y),e.addEventListener("submit",(function(e){e.preventDefault(),H([...n.value],!1)})),s.addEventListener("click",(function(){p[g].leftState&&function(e){if(e===g)return;const n=p[e]||p[f];for(const e of h)e.id!==n.activeContainer.id&&(e.style.display="none",e.dispatchEvent(new Event("hidden")));n.activeContainer.removeAttribute("style"),n.activeContainer.dispatchEvent(new Event("shown")),n.animation&&(n.activeContainer.classList.add(n.animation),n.activeContainer.addEventListener("animationend",(function(){n.activeContainer.classList.remove(n.animation)}),{once:!0})),n.leftButtonClass?(u.className=n.leftButtonClass,u.removeAttribute("style")):u.style.display="none";let t=f;f=n.statePreserving?g:null,g="previous"===e?t:e}(p[g].leftState)}));const i=function(e){"/"===e[0]&&(e=e.substring(1));const n=e.split("/");return n.length<2?null:decodeURIComponent(n[1])}(document.location.pathname);if(i)return void H([...i],!1);const l=["停","新","镦","貌","诬","客","警","嘴","醒","惯","倾","翻","嘟"];z(l[Math.floor(Math.random()*l.length)])}))}();

!function(){window.studyList=window.studyList||JSON.parse(localStorage.getItem("studyList")||"{}");function t(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)}var o=[],d=null,s=null,l=null,e="explore",a="study",n=e,i=5,c={},r=t();speechSynthesis.onvoiceschanged=function(){r=r||t()};var u=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},m=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},y=function(e){(r=r||t())&&((e=new SpeechSynthesisUtterance(e)).lang="zh-CN",e.voice=r,speechSynthesis.speak(e))},p=function(e,t){var n=document.createElement("span");n.className="text-button listen",n.textContent="Listen",n.addEventListener("click",y.bind(this,t),!1),e.appendChild(n)},h=function(){var e=5<o.length?o.slice(0,5):o;sessionStorage.setItem("state",JSON.stringify({hanzi:d,word:s,level:document.getElementById("level-selector").value,undoChain:e,activeTab:n}))},g=function(e){c={};for(var t=document.getElementById("examples");t.firstChild;)t.firstChild.remove();for(var n=0;n<e.length;n++){var o=function(e){for(var t=[],n=[],o=0;o<sentences.length;o++)if(sentences[o].zh.includes(e))if(sentences[o].en&&sentences[o].pinyin){if(t.push(sentences[o]),t.length===i)break}else n.length<i&&n.push(sentences[o]);return t.length<i&&0<n.length&&t.splice(t.length,0,...n.slice(0,i-t.length)),t.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length),t}(e[n]);c[e[n]]=[];var d=document.createElement("li"),l=document.createElement("h2");l.textContent=e[n],p(l,e[n]),function(e,d){var l=["In your study list!","Add this to my study list!"],a=document.createElement("span");a.className="text-button",a.textContent=studyList[d]?l[0]:l[1],a.addEventListener("click",function(){for(var e=c[d].map(e=>({...e,due:Date.now()})),t=[],n=0;n<e.length;n++){var o=e[n].zh.join("");t.push(o),!studyList[o]&&e[n].en&&(studyList[o]={en:e[n].en,due:e[n].due,zh:e[n].zh,wrongCount:0,rightCount:0})}saveStudyList(t),document.getElementById("exportStudyListButton").style.display="inline",a.textContent=l[0]}),e.appendChild(a)}(l,e[n]),d.appendChild(l);var a=document.createElement("ul");a.className="definition";l=definitions[e[n]]||[];!function(e,t){for(var n=0;n<e.length;n++){var o=document.createElement("li"),d=e[n].pinyin+": "+e[n].en;o.textContent=d,t.appendChild(o)}}(l,a),d.appendChild(a),c[e[n]].push(function(e,t){for(var n={zh:[e]},o="",d=0;d<t.length;d++){o+=t[d].pinyin+": "+t[d].en;o+=d==t.length-1?"":", "}return n["en"]=o,n}(e[n],l)),c[e[n]].push(...o);l=document.createElement("ul");d.appendChild(l),function(e,t){for(var n=0;n<e.length;n++){var o=document.createElement("li"),d=document.createElement("p"),l=e[n].zh.join("");B(l,d,!0),d.className="zh-example example-line",p(d,l),o.appendChild(d),e[n].pinyin&&((a=document.createElement("p")).textContent=e[n].pinyin,a.className="pinyin-example example-line",o.appendChild(a));var a=document.createElement("p");a.textContent=e[n].en,a.className="example-line",o.appendChild(a),t.appendChild(o)}}(o,l),t.append(d)}s=e},v=function(){o.push({hanzi:[...d],word:s&&[...s]})},E=function(e,t){var n={nodes:[],edges:[]};f(e,n,1,{},t),l.add(n),l.layout(m(e)).run(),d.push(e)},f=function(e,t,n,o,d){if(!(n<0)){var l,a,s,i,c=hanzi[e];o[e]=!0;for([l,a]of Object.entries(c.edges))0<n&&a.level<=d&&(o[l]||t.edges.push({data:{id:Array.from(e+l).sort().toString(),source:e,target:l,level:a.level,words:a.words}}));t.nodes.push({data:{id:e,level:c.node.level}});for([s,i]of Object.entries(c.edges))!o[s]&&i.level<=d&&f(s,t,n-1,o,d)}},I=function(e,t){document.getElementById("graph").remove();var n=document.createElement("div");n.id="graph",document.getElementById("container").append(n),e&&hanzi[e]&&(f(e,n={nodes:[],edges:[]},1,{},t),t=e,n=n,(l=cytoscape({container:document.getElementById("graph"),elements:n,layout:m(t),style:[{selector:"node",style:{"background-color":u,label:"data(id)",color:e=>3<e.data("level")?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":u,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"10px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}],maxZoom:10,minZoom:.5})).on("tap","node",function(e){var t=e.target.id(),e=document.getElementById("level-selector").value;v(),E(t,e),g([t]),h(),document.getElementById("show-explore").click()}),l.on("tap","edge",function(e){words=e.target.data("words"),v(),g(words),h(),document.getElementById("show-explore").click()}),d=[e],h())};document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,e=document.getElementById("level-selector").value;t&&(v(),I(t,e),g([document.getElementById("hanzi-box").value]),h())}),document.getElementById("level-selector").addEventListener("change",function(){I(d[d.length-1],document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=0<Object.keys(studyList).length?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let e="data:text/plain;charset=utf-8,";for(var[t,n]of Object.entries(studyList))e+=[t.replace(";",""),n.en.replace(";","")].join(";"),e+="\n";var o=encodeURI(e),d=document.createElement("a");d.setAttribute("href",o),d.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(d),d.click(),document.body.removeChild(d)});var B=function(e,t,n){var o=document.createElement("span");o.className="sentence-container";for(var d=0;d<e.length;d++)!function(e){var t=document.createElement("a");t.textContent=e,t.addEventListener("click",function(){hanzi[e]&&(v(),I(e,document.getElementById("level-selector").value),n||g([e]),h())}),o.appendChild(t)}(e[d]);t.appendChild(o)};document.getElementById("previousHanziButton").addEventListener("click",function(){if(o.length){var e=o.pop(),t=document.getElementById("level-selector").value;I(e.hanzi[0],t);for(var n=1;n<e.hanzi.length;n++)E(e.hanzi[n],t);e.word&&g(e.word),h()}});function w(){L=x=null,document.getElementById("card-answer-container").style.display="none";var e,t,n=0;for([e,t]of Object.entries(studyList))t.due<=Date.now()&&((!x||x.due>t.due)&&(x=t,L=e),n++);if(document.getElementById("card-due-count").textContent=n,document.getElementById("card-question-container").innerHTML="",0===n)return document.getElementById("task-complete").style.display="inline",document.getElementById("task-description").style.display="none",document.getElementById("show-answer-button").style.display="none",0;document.getElementById("task-complete").style.display="none",document.getElementById("task-description").style.display="inline",document.getElementById("show-answer-button").style.display="block",question=x.zh.join(""),B(question,document.getElementById("card-question-container")),p(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=x.en}var x=null,L=null;document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block",document.getElementById("card-answer-container").scrollIntoView()}),document.getElementById("wrong-button").addEventListener("click",function(){studyList[L].nextJump=.5,studyList[L].wrongCount++,studyList[L].due=Date.now()+9e5,saveStudyList([L]),w()}),document.getElementById("right-button").addEventListener("click",function(){var e=studyList[L].nextJump||.5;studyList[L].nextJump=2*e,studyList[L].rightCount++,studyList[L].due=Date.now()+24*e*60*60*1e3,saveStudyList([L]),w()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active"),n=e,h()}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),w(),n=a,h()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete studyList[L],saveStudyList([L]),w()}),function(){var e=JSON.parse(sessionStorage.getItem("state"));if(e){document.getElementById("level-selector").value=e.level,I(e.hanzi[0],e.level);for(var t=1;t<e.hanzi.length;t++)E(e.hanzi[t],e.level);e.word&&g(e.word),o=e.undoChain,e.activeTab===a&&document.getElementById("show-study").click(),h()}else{var n=["围","显","故","商","店"];I(n[Math.floor(Math.random()*n.length)],document.getElementById("level-selector").value)}}()}();

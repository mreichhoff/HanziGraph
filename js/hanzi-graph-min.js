!function(){var e=JSON.parse(localStorage.getItem("studyList")||"{}"),t=[],n=null,o={},l=function(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)},d=l();speechSynthesis.onvoiceschanged=function(){d||(d=l())};var a=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},c=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},i=function(e,t){var n=document.createElement("span");n.className="text-button",n.textContent="Listen",n.addEventListener("click",function(e){if(d=d||l()){var t=new SpeechSynthesisUtterance(e);t.lang="zh-CN",t.voice=d,speechSynthesis.speak(t)}}.bind(this,t),!1),e.appendChild(n)},s=function(t,n){var l=["In your study list!","Add this to my study list!"],d=document.createElement("span");d.className="text-button",d.textContent=e[n]?l[0]:l[1],d.addEventListener("click",function(){for(var t=o[n].map(e=>({...e,due:Date.now()})),a=0;a<t.length;a++){var c=t[a].zh.join("");!e[c]&&t[a].en&&(e[c]={en:t[a].en,due:t[a].due,zh:t[a].zh})}localStorage.setItem("studyList",JSON.stringify(e)),document.getElementById("exportStudyListButton").style.display="inline",d.textContent=l[0]}),t.appendChild(d)},r=function(e){o={};for(var t=document.getElementById("examples");t.firstChild;)t.firstChild.remove();for(var n=0;n<e.length;n++){var l=[];o[e[n]]=[];for(var d=[],a=0;a<sentences.length;a++)if(sentences[a].zh.includes(e[n]))if(sentences[a].en&&sentences[a].pinyin){if(l.push(sentences[a]),5===l.length)break}else d.length<5&&d.push(sentences[a]);l.length<5&&d.length>0&&l.splice(l.length,0,...d.slice(0,5-l.length)),l.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length);var c=document.createElement("li"),r=document.createElement("h2");r.textContent=e[n],i(r,e[n]),s(r,e[n]),c.appendChild(r);var m=document.createElement("ul"),y=definitions[e[n]]||[];for(a=0;a<y.length;a++){var p=document.createElement("li"),h=y[a].pinyin+": "+y[a].en;p.textContent=h,m.appendChild(p)}o[e[n]].push(u(e[n],y)),o[e[n]].push(...l),m.className="definition",c.appendChild(m);var v=document.createElement("ul");c.appendChild(v);for(a=0;a<l.length;a++){var E=document.createElement("li"),f=document.createElement("p"),I=l[a].zh.join("");if(g(I,f,!0),f.className="zh-example example-line",i(f,I),E.appendChild(f),l[a].pinyin){var B=document.createElement("p");B.textContent=l[a].pinyin,B.className="pinyin-example example-line",E.appendChild(B)}var x=document.createElement("p");x.textContent=l[a].en,x.className="example-line",E.appendChild(x),v.appendChild(E)}t.append(c)}},u=function(e,t){for(var n={zh:[e]},o="",l=0;l<t.length;l++)o+=t[l].pinyin+": "+t[l].en,o+=l==t.length-1?"":", ";return n.en=o,n},m=function(e,t,n,o,l){if(!(n<0)){var d=hanzi[e];o[e]=!0;for(const[a,c]of Object.entries(d.edges))n>0&&c.level<=l&&(o[a]||t.edges.push({data:{id:Array.from(e+a).sort().toString(),source:e,target:a,level:c.level,words:c.words}}));t.nodes.push({data:{id:e,level:d.node.level}});for(const[e,a]of Object.entries(d.edges))!o[e]&&a.level<=l&&m(e,t,n-1,o,l)}},y=function(e,o,l){document.getElementById("graph").remove();var d,i,s,u=document.createElement("div");if(u.id="graph",document.getElementById("container").append(u),e&&hanzi[e]){var y={nodes:[],edges:[]};m(e,y,1,{},o),d=e,i=y,(s=cytoscape({container:document.getElementById("graph"),elements:i,layout:c(d),style:[{selector:"node",style:{"background-color":a,label:"data(id)",color:e=>e.data("level")>3?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":a,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"8px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}]})).on("tap","node",function(e){var o=e.target.id(),l=document.getElementById("level-selector").value,d={nodes:[],edges:[]};document.getElementById("hanzi-box").value,m(o,d,1,{},l),s.add(d),s.layout(c(o)).run(),t.push(n),n=o,r([o])}),s.on("tap","edge",function(e){words=e.target.data("words"),r(words),document.getElementById("show-explore").click()}),n&&!l&&t.push(n),n=e}},p=["围","显","故","商","店"];y(p[Math.floor(Math.random()*p.length)],document.getElementById("level-selector").value),document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,n=document.getElementById("level-selector").value;t&&(y(t,n),r([document.getElementById("hanzi-box").value]))}),document.getElementById("level-selector").addEventListener("change",function(){y(document.getElementById("hanzi-box").value,document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=Object.keys(e).length>0?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let t="data:text/plain;charset=utf-8,";for(const[n,o]of Object.entries(e))t+=[n.replace(";",""),o.en.replace(";","")].join(";"),t+="\n";var n=encodeURI(t),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(o),o.click(),document.body.removeChild(o)});var g=function(e,t,n){for(var o=0;o<e.length;o++)!function(e){var o=document.createElement("a");o.textContent=e,o.addEventListener("click",function(){hanzi[e]&&(y(e,document.getElementById("level-selector").value),n||r([e]))}),t.appendChild(o)}(e[o])};document.getElementById("previousHanziButton").addEventListener("click",function(){if(t.length){var e=t.pop();y(e,document.getElementById("level-selector").value,!0),r([e]),n=e}});var h=null,v=null,E=function(){h=null,v=null,document.getElementById("card-answer-container").style.display="none";var t=0;for(const[n,o]of Object.entries(e))o.due<=Date.now()&&(h||(h=o,v=n),t++);if(document.getElementById("card-due-count").textContent=t,document.getElementById("card-question-container").innerHTML="",0===t)return document.getElementById("task-complete").style.display="inline",document.getElementById("task-description").style.display="none",void(document.getElementById("show-answer-button").style.display="none");document.getElementById("task-complete").style.display="none",document.getElementById("task-description").style.display="inline",document.getElementById("show-answer-button").style.display="block",question=h.zh.join(""),g(question,document.getElementById("card-question-container")),i(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=h.en};document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block"}),document.getElementById("wrong-button").addEventListener("click",function(){e[v].nextJump=.5,e[v].due=Date.now()+9e5,localStorage.setItem("studyList",JSON.stringify(e)),E()}),document.getElementById("right-button").addEventListener("click",function(){var t=e[v].nextJump||.5;e[v].nextJump=2*t,e[v].due=Date.now()+24*t*60*60*1e3,localStorage.setItem("studyList",JSON.stringify(e)),E()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active")}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),E()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete e[v],localStorage.setItem("studyList",JSON.stringify(e)),E()})}();

!function(){var e=JSON.parse(localStorage.getItem("studyList")||"{}"),t={},n=function(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)},o=n();speechSynthesis.onvoiceschanged=function(){o||(o=n())};var l=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},d=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},a=function(e,t){var l=document.createElement("span");l.className="text-button",l.textContent="Listen",l.addEventListener("click",function(e){if(o=o||n()){var t=new SpeechSynthesisUtterance(e);t.lang="zh-CN",t.voice=o,speechSynthesis.speak(t)}}.bind(this,t),!1),e.appendChild(l)},c=function(n,o){var l=document.createElement("span");l.className="text-button",l.textContent="Add this to my study list!",l.addEventListener("click",function(){for(var n=t[o].map(e=>({...e,due:Date.now()})),l=0;l<n.length;l++){var d=n[l].zh.join("");!e[d]&&n[l].en&&(e[d]={en:n[l].en,due:n[l].due,zh:n[l].zh})}localStorage.setItem("studyList",JSON.stringify(e)),document.getElementById("exportStudyListButton").style.display="inline"}),n.appendChild(l)},i=function(e){t={};for(var n=document.getElementById("examples");n.firstChild;)n.firstChild.remove();for(var o=0;o<e.length;o++){var l=[];t[e[o]]=[];for(var d=[],i=0;i<sentences.length;i++)if(sentences[i].zh.includes(e[o]))if(sentences[i].en&&sentences[i].pinyin){if(l.push(sentences[i]),5===l.length)break}else d.length<5&&d.push(sentences[i]);l.length<5&&d.length>0&&l.splice(l.length,0,...d.slice(0,5-l.length)),l.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length);var r=document.createElement("li"),u=document.createElement("h2");u.textContent=e[o],a(u,e[o]),c(u,e[o]),r.appendChild(u);var m=document.createElement("ul"),p=definitions[e[o]]||[];for(i=0;i<p.length;i++){var g=document.createElement("li"),h=p[i].pinyin+": "+p[i].en;g.textContent=h,m.appendChild(g)}t[e[o]].push(s(e[o],p)),t[e[o]].push(...l),m.className="definition",r.appendChild(m);var v=document.createElement("ul");r.appendChild(v);for(i=0;i<l.length;i++){var E=document.createElement("li"),f=document.createElement("p"),I=l[i].zh.join("");if(y(I,f),f.className="zh-example example-line",a(f,I),E.appendChild(f),l[i].pinyin){var B=document.createElement("p");B.textContent=l[i].pinyin,B.className="pinyin-example example-line",E.appendChild(B)}var x=document.createElement("p");x.textContent=l[i].en,x.className="example-line",E.appendChild(x),v.appendChild(E)}n.append(r)}},s=function(e,t){for(var n={zh:[e]},o="",l=0;l<t.length;l++)o+=t[l].pinyin+": "+t[l].en,o+=l==t.length-1?"":", ";return n.en=o,n},r=function(e,t,n,o,l){if(!(n<0)){var d=hanzi[e];o[e]=!0;for(const[a,c]of Object.entries(d.edges))n>0&&c.level<=l&&(o[a]||t.edges.push({data:{id:Array.from(e+a).sort().toString(),source:e,target:a,level:c.level,words:c.words}}));t.nodes.push({data:{id:e,level:d.node.level}});for(const[e,a]of Object.entries(d.edges))!o[e]&&a.level<=l&&r(e,t,n-1,o,l)}},u=function(e,t){document.getElementById("graph").remove();var n,o,a,c=document.createElement("div");if(c.id="graph",document.getElementById("container").append(c),e&&hanzi[e]){var s={nodes:[],edges:[]};r(e,s,1,{},t),n=e,o=s,(a=cytoscape({container:document.getElementById("graph"),elements:o,layout:d(n),style:[{selector:"node",style:{"background-color":l,label:"data(id)",color:e=>e.data("level")>3?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":l,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"8px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}]})).on("tap","node",function(e){var t=e.target.id(),n=document.getElementById("level-selector").value,o={nodes:[],edges:[]};document.getElementById("hanzi-box").value,r(t,o,1,{},n),a.add(o),a.layout(d(t)).run(),i([t])}),a.on("tap","edge",function(e){words=e.target.data("words"),i(words),document.getElementById("show-explore").click()})}},m=["围","显","故","商","店"];u(m[Math.floor(Math.random()*m.length)],document.getElementById("level-selector").value),document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,n=document.getElementById("level-selector").value;t&&(u(t,n),i([document.getElementById("hanzi-box").value]))}),document.getElementById("level-selector").addEventListener("change",function(){u(document.getElementById("hanzi-box").value,document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=Object.keys(e).length>0?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let t="data:text/plain;charset=utf-8,";for(const[n,o]of Object.entries(e))t+=[n.replace(";",""),o.en.replace(";","")].join(";"),t+="\n";var n=encodeURI(t),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(o),o.click(),document.body.removeChild(o)});var y=function(e,t){for(var n=0;n<e.length;n++)!function(e){var n=document.createElement("a");n.textContent=e,n.addEventListener("click",function(){hanzi[e]&&(u(e,document.getElementById("level-selector").value),i([e]))}),t.appendChild(n)}(e[n])},p=null,g=null,h=function(){p=null,g=null,document.getElementById("card-answer-container").style.display="none";var t=0;for(const[n,o]of Object.entries(e))o.due<=Date.now()&&(p||(p=o,g=n),t++);if(document.getElementById("card-due-count").textContent=t,document.getElementById("card-question-container").innerHTML="",0===t)return document.getElementById("task-complete").style.display="inline",document.getElementById("task-description").style.display="none",void(document.getElementById("show-answer-button").style.display="none");document.getElementById("task-complete").style.display="none",document.getElementById("task-description").style.display="inline",document.getElementById("show-answer-button").style.display="block",question=p.zh.join(""),y(question,document.getElementById("card-question-container")),a(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=p.en};document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block"}),document.getElementById("wrong-button").addEventListener("click",function(){e[g].nextJump=.5,e[g].due=Date.now()+9e5,localStorage.setItem("studyList",JSON.stringify(e)),h()}),document.getElementById("right-button").addEventListener("click",function(){var t=e[g].nextJump||.5;e[g].nextJump=2*t,e[g].due=Date.now()+24*t*60*60*1e3,localStorage.setItem("studyList",JSON.stringify(e)),h()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active")}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),h()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete e[g],localStorage.setItem("studyList",JSON.stringify(e)),h()})}();

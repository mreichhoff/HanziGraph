!function(){var e=JSON.parse(localStorage.getItem("studyList")||"{}"),t=[],n=null,o=null,l={},d=function(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)},a=d();speechSynthesis.onvoiceschanged=function(){a||(a=d())};var c=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},i=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},s=function(e,t){var n=document.createElement("span");n.className="text-button",n.textContent="Listen",n.addEventListener("click",function(e){if(a=a||d()){var t=new SpeechSynthesisUtterance(e);t.lang="zh-CN",t.voice=a,speechSynthesis.speak(t)}}.bind(this,t),!1),e.appendChild(n)},r=function(t,n){var o=["In your study list!","Add this to my study list!"],d=document.createElement("span");d.className="text-button",d.textContent=e[n]?o[0]:o[1],d.addEventListener("click",function(){for(var t=l[n].map(e=>({...e,due:Date.now()})),a=0;a<t.length;a++){var c=t[a].zh.join("");!e[c]&&t[a].en&&(e[c]={en:t[a].en,due:t[a].due,zh:t[a].zh})}localStorage.setItem("studyList",JSON.stringify(e)),document.getElementById("exportStudyListButton").style.display="inline",d.textContent=o[0]}),t.appendChild(d)},u=function(){var e=t.length>5?t.slice(0,5):t;sessionStorage.setItem("state",JSON.stringify({hanzi:n,word:o,level:document.getElementById("level-selector").value,undoChain:e}))},m=function(e){l={};for(var t=document.getElementById("examples");t.firstChild;)t.firstChild.remove();for(var n=0;n<e.length;n++){var o=[];l[e[n]]=[];for(var d=[],a=0;a<sentences.length;a++)if(sentences[a].zh.includes(e[n]))if(sentences[a].en&&sentences[a].pinyin){if(o.push(sentences[a]),5===o.length)break}else d.length<5&&d.push(sentences[a]);o.length<5&&d.length>0&&o.splice(o.length,0,...d.slice(0,5-o.length)),o.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length);var c=document.createElement("li"),i=document.createElement("h2");i.textContent=e[n],s(i,e[n]),r(i,e[n]),c.appendChild(i);var u=document.createElement("ul"),m=definitions[e[n]]||[];for(a=0;a<m.length;a++){var g=document.createElement("li"),p=m[a].pinyin+": "+m[a].en;g.textContent=p,u.appendChild(g)}l[e[n]].push(y(e[n],m)),l[e[n]].push(...o),u.className="definition",c.appendChild(u);var v=document.createElement("ul");c.appendChild(v);for(a=0;a<o.length;a++){var E=document.createElement("li"),f=document.createElement("p"),I=o[a].zh.join("");if(h(I,f,!0),f.className="zh-example example-line",s(f,I),E.appendChild(f),o[a].pinyin){var B=document.createElement("p");B.textContent=o[a].pinyin,B.className="pinyin-example example-line",E.appendChild(B)}var x=document.createElement("p");x.textContent=o[a].en,x.className="example-line",E.appendChild(x),v.appendChild(E)}t.append(c)}},y=function(e,t){for(var n={zh:[e]},o="",l=0;l<t.length;l++)o+=t[l].pinyin+": "+t[l].en,o+=l==t.length-1?"":", ";return n.en=o,n},g=function(e,t,n,o,l){if(!(n<0)){var d=hanzi[e];o[e]=!0;for(const[a,c]of Object.entries(d.edges))n>0&&c.level<=l&&(o[a]||t.edges.push({data:{id:Array.from(e+a).sort().toString(),source:e,target:a,level:c.level,words:c.words}}));t.nodes.push({data:{id:e,level:d.node.level}});for(const[e,a]of Object.entries(d.edges))!o[e]&&a.level<=l&&g(e,t,n-1,o,l)}},p=function(e,l,d){document.getElementById("graph").remove();var a,s,r,y=document.createElement("div");if(y.id="graph",document.getElementById("container").append(y),e&&hanzi[e]){var p={nodes:[],edges:[]};g(e,p,1,{},l),a=e,s=p,(r=cytoscape({container:document.getElementById("graph"),elements:s,layout:i(a),style:[{selector:"node",style:{"background-color":c,label:"data(id)",color:e=>e.data("level")>3?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":c,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"8px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}]})).on("tap","node",function(e){var l=e.target.id(),d=document.getElementById("level-selector").value,a={nodes:[],edges:[]};document.getElementById("hanzi-box").value,g(l,a,1,{},d),r.add(a),r.layout(i(l)).run(),t.push({hanzi:n,word:o}),n=l,o=[l],m([l]),u()}),r.on("tap","edge",function(e){words=e.target.data("words"),m(words),t.push({hanzi:n,word:o}),o=words,u(),document.getElementById("show-explore").click()}),n&&!d&&t.push({hanzi:n,word:o}),n=e,o=[e],u()}};document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,n=document.getElementById("level-selector").value;t&&(p(t,n),m([document.getElementById("hanzi-box").value]))}),document.getElementById("level-selector").addEventListener("change",function(){p(document.getElementById("hanzi-box").value||n,document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=Object.keys(e).length>0?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let t="data:text/plain;charset=utf-8,";for(const[n,o]of Object.entries(e))t+=[n.replace(";",""),o.en.replace(";","")].join(";"),t+="\n";var n=encodeURI(t),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(o),o.click(),document.body.removeChild(o)});var h=function(e,t,n){for(var o=0;o<e.length;o++)!function(e){var o=document.createElement("a");o.textContent=e,o.addEventListener("click",function(){hanzi[e]&&(p(e,document.getElementById("level-selector").value),n||m([e]))}),t.appendChild(o)}(e[o])};document.getElementById("previousHanziButton").addEventListener("click",function(){if(t.length){var e=t.pop();p(e.hanzi,document.getElementById("level-selector").value,!0),m(e.word),n=e.hanzi,o=e.word,u()}});var v=null,E=null,f=function(){v=null,E=null,document.getElementById("card-answer-container").style.display="none";var t=0;for(const[n,o]of Object.entries(e))o.due<=Date.now()&&((!v||v.due>o.due)&&(v=o,E=n),t++);if(document.getElementById("card-due-count").textContent=t,document.getElementById("card-question-container").innerHTML="",0===t)return document.getElementById("task-complete").style.display="inline",document.getElementById("task-description").style.display="none",void(document.getElementById("show-answer-button").style.display="none");document.getElementById("task-complete").style.display="none",document.getElementById("task-description").style.display="inline",document.getElementById("show-answer-button").style.display="block",question=v.zh.join(""),h(question,document.getElementById("card-question-container")),s(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=v.en};document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block"}),document.getElementById("wrong-button").addEventListener("click",function(){e[E].nextJump=.5,e[E].due=Date.now()+9e5,localStorage.setItem("studyList",JSON.stringify(e)),f()}),document.getElementById("right-button").addEventListener("click",function(){var t=e[E].nextJump||.5;e[E].nextJump=2*t,e[E].due=Date.now()+24*t*60*60*1e3,localStorage.setItem("studyList",JSON.stringify(e)),f()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active")}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),f()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete e[E],localStorage.setItem("studyList",JSON.stringify(e)),f()}),function(){var e=JSON.parse(sessionStorage.getItem("state"));if(e)document.getElementById("level-selector").value=e.level,p(e.hanzi,e.level),m(e.word),t=e.undoChain;else{var n=["围","显","故","商","店"];p(n[Math.floor(Math.random()*n.length)],document.getElementById("level-selector").value)}}()}();

!function(){function t(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)}var v=JSON.parse(localStorage.getItem("studyList")||"{}"),d=[],a=null,c=null,E={},n=t();speechSynthesis.onvoiceschanged=function(){n=n||t()};function f(e,t){var n=document.createElement("span");n.className="text-button",n.textContent="Listen",n.addEventListener("click",o.bind(this,t),!1),e.appendChild(n)}function l(e,t,n){var o,l;document.getElementById("graph").remove(),(l=document.createElement("div")).id="graph",document.getElementById("container").append(l),e&&hanzi[e]&&(m(e,l={nodes:[],edges:[]},1,{},t),t=e,l=l,(o=cytoscape({container:document.getElementById("graph"),elements:l,layout:i(t),style:[{selector:"node",style:{"background-color":s,label:"data(id)",color:e=>3<e.data("level")?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":s,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"8px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}]})).on("tap","node",function(e){var t=e.target.id(),n=document.getElementById("level-selector").value,e={nodes:[],edges:[]};m(t,e,1,{},n),o.add(e),o.layout(i(t)).run(),d.push({hanzi:a,word:c}),c=[a=t],u([t]),r()}),o.on("tap","edge",function(e){words=e.target.data("words"),u(words),d.push({hanzi:a,word:c}),c=words,r(),document.getElementById("show-explore").click()}),a&&!n&&d.push({hanzi:a,word:c}),c=[a=e],r())}var s=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},i=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},o=function(e){(n=n||t())&&((e=new SpeechSynthesisUtterance(e)).lang="zh-CN",e.voice=n,speechSynthesis.speak(e))},r=function(){var e=5<d.length?d.slice(0,5):d;sessionStorage.setItem("state",JSON.stringify({hanzi:a,word:c,level:document.getElementById("level-selector").value,undoChain:e}))},u=function(e){E={};for(var t=document.getElementById("examples");t.firstChild;)t.firstChild.remove();for(var n=0;n<e.length;n++){var o=[];E[e[n]]=[];for(var l=[],d=0;d<sentences.length;d++)if(sentences[d].zh.includes(e[n]))if(sentences[d].en&&sentences[d].pinyin){if(o.push(sentences[d]),5===o.length)break}else l.length<5&&l.push(sentences[d]);o.length<5&&0<l.length&&o.splice(o.length,0,...l.slice(0,5-o.length)),o.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length);var a=document.createElement("li"),c=document.createElement("h2");c.textContent=e[n],f(c,e[n]),function(e,o){var l=["In your study list!","Add this to my study list!"],d=document.createElement("span");d.className="text-button",d.textContent=v[o]?l[0]:l[1],d.addEventListener("click",function(){for(var e=E[o].map(e=>({...e,due:Date.now()})),t=0;t<e.length;t++){var n=e[t].zh.join("");!v[n]&&e[t].en&&(v[n]={en:e[t].en,due:e[t].due,zh:e[t].zh})}localStorage.setItem("studyList",JSON.stringify(v)),document.getElementById("exportStudyListButton").style.display="inline",d.textContent=l[0]}),e.appendChild(d)}(c,e[n]),a.appendChild(c);for(var s=document.createElement("ul"),i=definitions[e[n]]||[],d=0;d<i.length;d++){var r=document.createElement("li"),u=i[d].pinyin+": "+i[d].en;r.textContent=u,s.appendChild(r)}E[e[n]].push(function(e,t){for(var n={zh:[e]},o="",l=0;l<t.length;l++){o+=t[l].pinyin+": "+t[l].en;o+=l==t.length-1?"":", "}return n["en"]=o,n}(e[n],i)),E[e[n]].push(...o),s.className="definition",a.appendChild(s);var m=document.createElement("ul");a.appendChild(m);for(d=0;d<o.length;d++){var y=document.createElement("li"),g=document.createElement("p"),p=o[d].zh.join("");I(p,g,!0),g.className="zh-example example-line",f(g,p),y.appendChild(g),o[d].pinyin&&((h=document.createElement("p")).textContent=o[d].pinyin,h.className="pinyin-example example-line",y.appendChild(h));var h=document.createElement("p");h.textContent=o[d].en,h.className="example-line",y.appendChild(h),m.appendChild(y)}t.append(a)}},m=function(e,t,n,o,l){if(!(n<0)){var d,a,c,s,i=hanzi[e];o[e]=!0;for([d,a]of Object.entries(i.edges))0<n&&a.level<=l&&(o[d]||t.edges.push({data:{id:Array.from(e+d).sort().toString(),source:e,target:d,level:a.level,words:a.words}}));t.nodes.push({data:{id:e,level:i.node.level}});for([c,s]of Object.entries(i.edges))!o[c]&&s.level<=l&&m(c,t,n-1,o,l)}};document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,e=document.getElementById("level-selector").value;t&&(l(t,e),u([document.getElementById("hanzi-box").value]))}),document.getElementById("level-selector").addEventListener("change",function(){l(document.getElementById("hanzi-box").value||a,document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=0<Object.keys(v).length?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let e="data:text/plain;charset=utf-8,";for(var[t,n]of Object.entries(v))e+=[t.replace(";",""),n.en.replace(";","")].join(";"),e+="\n";var o=encodeURI(e),l=document.createElement("a");l.setAttribute("href",o),l.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(l),l.click(),document.body.removeChild(l)});var I=function(e,n,o){for(var t=0;t<e.length;t++)!function(e){var t=document.createElement("a");t.textContent=e,t.addEventListener("click",function(){hanzi[e]&&(l(e,document.getElementById("level-selector").value),o||u([e]))}),n.appendChild(t)}(e[t])};document.getElementById("previousHanziButton").addEventListener("click",function(){var e;d.length&&(e=d.pop(),l(e.hanzi,document.getElementById("level-selector").value,!0),u(e.word),a=e.hanzi,c=e.word,r())});function y(){p=g=null,document.getElementById("card-answer-container").style.display="none";var e,t,n=0;for([e,t]of Object.entries(v))t.due<=Date.now()&&((!g||g.due>t.due)&&(g=t,p=e),n++);if(document.getElementById("card-due-count").textContent=n,document.getElementById("card-question-container").innerHTML="",0===n)return document.getElementById("task-complete").style.display="inline",document.getElementById("task-description").style.display="none",document.getElementById("show-answer-button").style.display="none",0;document.getElementById("task-complete").style.display="none",document.getElementById("task-description").style.display="inline",document.getElementById("show-answer-button").style.display="block",question=g.zh.join(""),I(question,document.getElementById("card-question-container")),f(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=g.en}var e,g=null,p=null;document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block"}),document.getElementById("wrong-button").addEventListener("click",function(){v[p].nextJump=.5,v[p].due=Date.now()+9e5,localStorage.setItem("studyList",JSON.stringify(v)),y()}),document.getElementById("right-button").addEventListener("click",function(){var e=v[p].nextJump||.5;v[p].nextJump=2*e,v[p].due=Date.now()+24*e*60*60*1e3,localStorage.setItem("studyList",JSON.stringify(v)),y()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active")}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),y()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete v[p],localStorage.setItem("studyList",JSON.stringify(v)),y()}),(e=JSON.parse(sessionStorage.getItem("state")))?(document.getElementById("level-selector").value=e.level,l(e.hanzi,e.level),u(e.word),d=e.undoChain):l((e=["围","显","故","商","店"])[Math.floor(Math.random()*e.length)],document.getElementById("level-selector").value)}();

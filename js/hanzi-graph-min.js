!function(){var e=JSON.parse(localStorage.getItem("studyList")||"{}"),t={},n=function(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)},o=n();speechSynthesis.onvoiceschanged=function(){o||(o=n())};var d=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},l=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},a=function(e,t){var d=document.createElement("span");d.className="text-button",d.textContent="Listen",d.addEventListener("click",function(e){if(o=o||n()){var t=new SpeechSynthesisUtterance(e);t.lang="zh-CN",t.voice=o,speechSynthesis.speak(t)}}.bind(this,t),!1),e.appendChild(d)},c=function(n,o){var d=document.createElement("span");d.className="text-button",d.textContent="Add this to my study list!",d.addEventListener("click",function(){for(var n=t[o].map(e=>({...e,due:Date.now()})),d=0;d<n.length;d++){var l=n[d].zh.join("");!e[l]&&n[d].en&&(e[l]={en:n[d].en,due:n[d].due,zh:n[d].zh})}localStorage.setItem("studyList",JSON.stringify(e)),document.getElementById("exportStudyListButton").style.display="inline"}),n.appendChild(d)},i=function(e){t={};for(var n=document.getElementById("examples");n.firstChild;)n.firstChild.remove();for(var o=0;o<e.length;o++){var d=[];t[e[o]]=[];for(var l=[],i=0;i<sentences.length;i++)if(sentences[i].zh.includes(e[o]))if(sentences[i].en&&sentences[i].pinyin){if(d.push(sentences[i]),5===d.length)break}else l.length<5&&l.push(sentences[i]);d.length<5&&l.length>0&&d.splice(d.length,0,...l.slice(0,5-d.length)),d.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length);var r=document.createElement("li"),u=document.createElement("h2");u.textContent=e[o],a(u,e[o]),c(u,e[o]),r.appendChild(u);var m=document.createElement("ul"),y=definitions[e[o]]||[];for(i=0;i<y.length;i++){var p=document.createElement("li"),h=y[i].pinyin+": "+y[i].en;p.textContent=h,m.appendChild(p)}t[e[o]].push(s(e[o],y)),t[e[o]].push(...d),m.className="definition",r.appendChild(m);var v=document.createElement("ul");r.appendChild(v);for(i=0;i<d.length;i++){var E=document.createElement("li"),f=document.createElement("p"),I=d[i].zh.join("");if(g(I,f),f.className="zh-example example-line",a(f,I),E.appendChild(f),d[i].pinyin){var B=document.createElement("p");B.textContent=d[i].pinyin,B.className="pinyin-example example-line",E.appendChild(B)}var x=document.createElement("p");x.textContent=d[i].en,x.className="example-line",E.appendChild(x),v.appendChild(E)}n.append(r)}},s=function(e,t){for(var n={zh:[e]},o="",d=0;d<t.length;d++)o+=t[d].pinyin+": "+t[d].en,o+=d==t.length-1?"":", ";return n.en=o,n},r=function(e,t,n,o,d){if(!(n<0)){var l=hanzi[e];o[e]=!0;for(const[a,c]of Object.entries(l.edges))n>0&&c.level<=d&&(o[a]||t.edges.push({data:{id:Array.from(e+a).sort().toString(),source:e,target:a,level:c.level,words:c.words}}));t.nodes.push({data:{id:e,level:l.node.level}});for(const[e,a]of Object.entries(l.edges))!o[e]&&a.level<=d&&r(e,t,n-1,o,d)}},u=function(e,t){document.getElementById("graph").remove();var n,o,a,c=document.createElement("div");if(c.id="graph",document.getElementById("container").append(c),e&&hanzi[e]){var s={nodes:[],edges:[]};r(e,s,1,{},t),n=e,o=s,(a=cytoscape({container:document.getElementById("graph"),elements:o,layout:l(n),style:[{selector:"node",style:{"background-color":d,label:"data(id)",color:e=>e.data("level")>3?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":d,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"8px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}]})).on("tap","node",function(e){var t=e.target.id(),n=document.getElementById("level-selector").value,o={nodes:[],edges:[]};document.getElementById("hanzi-box").value,r(t,o,1,{},n),a.add(o),a.layout(l(t)).run(),i([t])}),a.on("tap","edge",function(e){words=e.target.data("words"),i(words),document.getElementById("show-explore").click()})}},m=["围","显","故","商","店"];u(m[Math.floor(Math.random()*m.length)],document.getElementById("level-selector").value),document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,n=document.getElementById("level-selector").value;t&&(u(t,n),i([document.getElementById("hanzi-box").value]))}),document.getElementById("level-selector").addEventListener("change",function(){u(document.getElementById("hanzi-box").value,document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=Object.keys(e).length>0?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let t="data:text/plain;charset=utf-8,";for(const[n,o]of Object.entries(e))t+=[n.replace(";",""),o.en.replace(";","")].join(";"),t+="\n";var n=encodeURI(t),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(o),o.click(),document.body.removeChild(o)});var g=function(e,t){for(var n=0;n<e.length;n++)!function(e){var n=document.createElement("a");n.textContent=e,n.addEventListener("click",function(){hanzi[e]&&(u(e,document.getElementById("level-selector").value),i([e]))}),t.appendChild(n)}(e[n])},y=null,p=null,h=function(){y=null,p=null,document.getElementById("card-answer-container").style.display="none";var t=0;for(const[n,o]of Object.entries(e))o.due<=Date.now()&&(y||(y=o,p=n),t++);if(document.getElementById("card-due-count").textContent=t,document.getElementById("card-question-container").innerHTML="",0===t)return document.getElementById("study-call-to-action").textContent="Studying complete. You can add more cards by exploring the graph!",void(document.getElementById("show-answer-button").style.display="none");document.getElementById("study-call-to-action").textContent="What does this sentence mean?",document.getElementById("show-answer-button").style.display="block",question=y.zh.join(""),g(question,document.getElementById("card-question-container")),a(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=y.en};document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block"}),document.getElementById("wrong-button").addEventListener("click",function(){e[p].nextJump=.5,e[p].due=Date.now()+9e5,localStorage.setItem("studyList",JSON.stringify(e)),h()}),document.getElementById("right-button").addEventListener("click",function(){var t=e[p].nextJump||.5;e[p].nextJump=2*t,e[p].due=Date.now()+24*t*60*60*1e3,localStorage.setItem("studyList",JSON.stringify(e)),h()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active")}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),h()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete e[p],localStorage.setItem("studyList",JSON.stringify(e)),h()})}();

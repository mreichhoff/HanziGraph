!function(){function t(){return speechSynthesis.getVoices().find(e=>"zh-CN"===e.lang)}var c=JSON.parse(localStorage.getItem("studyList")||"{}"),l=[],o=null,i=null,d=null,e="explore",a="study",n=e,s=5,r={},u=t();speechSynthesis.onvoiceschanged=function(){u=u||t()};var m=function(e){switch(e.data("level")){case 6:return"blue";case 5:return"purple";case 4:return"green";case 3:return"yellow";case 2:return"orange";case 1:return"red"}},y=function(e){return{name:"breadthfirst",roots:[e],padding:6,spacingFactor:.85}},g=function(e){(u=u||t())&&((e=new SpeechSynthesisUtterance(e)).lang="zh-CN",e.voice=u,speechSynthesis.speak(e))},p=function(e,t){var n=document.createElement("span");n.className="text-button listen",n.textContent="Listen",n.addEventListener("click",g.bind(this,t),!1),e.appendChild(n)},h=function(){var e=5<l.length?l.slice(0,5):l;sessionStorage.setItem("state",JSON.stringify({hanzi:o,word:i,level:document.getElementById("level-selector").value,undoChain:e,activeTab:n}))},v=function(e){r={};for(var t=document.getElementById("examples");t.firstChild;)t.firstChild.remove();for(var n=0;n<e.length;n++){var l=function(e){for(var t=[],n=[],l=0;l<sentences.length;l++)if(sentences[l].zh.includes(e))if(sentences[l].en&&sentences[l].pinyin){if(t.push(sentences[l]),t.length===s)break}else n.length<s&&n.push(sentences[l]);return t.length<s&&0<n.length&&t.splice(t.length,0,...n.slice(0,s-t.length)),t.sort((e,t)=>e.en&&!t.en?-1:!e.en&&t.en?1:e.zh.length-t.zh.length),t}(e[n]);r[e[n]]=[];var o=document.createElement("li"),d=document.createElement("h2");d.textContent=e[n],p(d,e[n]),function(e,l){var o=["In your study list!","Add this to my study list!"],d=document.createElement("span");d.className="text-button",d.textContent=c[l]?o[0]:o[1],d.addEventListener("click",function(){for(var e=r[l].map(e=>({...e,due:Date.now()})),t=0;t<e.length;t++){var n=e[t].zh.join("");!c[n]&&e[t].en&&(c[n]={en:e[t].en,due:e[t].due,zh:e[t].zh})}localStorage.setItem("studyList",JSON.stringify(c)),document.getElementById("exportStudyListButton").style.display="inline",d.textContent=o[0]}),e.appendChild(d)}(d,e[n]),o.appendChild(d);var a=document.createElement("ul");a.className="definition";d=definitions[e[n]]||[];!function(e,t){for(var n=0;n<e.length;n++){var l=document.createElement("li"),o=e[n].pinyin+": "+e[n].en;l.textContent=o,t.appendChild(l)}}(d,a),o.appendChild(a),r[e[n]].push(function(e,t){for(var n={zh:[e]},l="",o=0;o<t.length;o++){l+=t[o].pinyin+": "+t[o].en;l+=o==t.length-1?"":", "}return n["en"]=l,n}(e[n],d)),r[e[n]].push(...l);d=document.createElement("ul");o.appendChild(d),function(e,t){for(var n=0;n<e.length;n++){var l=document.createElement("li"),o=document.createElement("p"),d=e[n].zh.join("");x(d,o,!0),o.className="zh-example example-line",p(o,d),l.appendChild(o),e[n].pinyin&&((a=document.createElement("p")).textContent=e[n].pinyin,a.className="pinyin-example example-line",l.appendChild(a));var a=document.createElement("p");a.textContent=e[n].en,a.className="example-line",l.appendChild(a),t.appendChild(l)}}(l,d),t.append(o)}i=e},f=function(){l.push({hanzi:[...o],word:i&&[...i]})},E=function(e,t){var n={nodes:[],edges:[]};I(e,n,1,{},t),d.add(n),d.layout(y(e)).run(),o.push(e)},I=function(e,t,n,l,o){if(!(n<0)){var d,a,c,i,s=hanzi[e];l[e]=!0;for([d,a]of Object.entries(s.edges))0<n&&a.level<=o&&(l[d]||t.edges.push({data:{id:Array.from(e+d).sort().toString(),source:e,target:d,level:a.level,words:a.words}}));t.nodes.push({data:{id:e,level:s.node.level}});for([c,i]of Object.entries(s.edges))!l[c]&&i.level<=o&&I(c,t,n-1,l,o)}},B=function(e,t){document.getElementById("graph").remove();var n=document.createElement("div");n.id="graph",document.getElementById("container").append(n),e&&hanzi[e]&&(I(e,n={nodes:[],edges:[]},1,{},t),t=e,n=n,(d=cytoscape({container:document.getElementById("graph"),elements:n,layout:y(t),style:[{selector:"node",style:{"background-color":m,label:"data(id)",color:e=>3<e.data("level")?"#eee":"#333333","font-size":"16px","text-valign":"center","text-halign":"center"}},{selector:"edge",style:{"line-color":m,"target-arrow-shape":"none","curve-style":"straight",label:"data(words)",color:"#eee","font-size":"8px","text-background-color":"#333333","text-background-opacity":"1","text-background-shape":"round-rectangle"}}]})).on("tap","node",function(e){var t=e.target.id(),e=document.getElementById("level-selector").value;f(),E(t,e),v([t]),h()}),d.on("tap","edge",function(e){words=e.target.data("words"),f(),v(words),h(),document.getElementById("show-explore").click()}),o=[e],h())};document.getElementById("hanzi-choose").addEventListener("submit",function(e){e.preventDefault();var t=document.getElementById("hanzi-box").value,e=document.getElementById("level-selector").value;t&&(f(),B(t,e),v([document.getElementById("hanzi-box").value]))}),document.getElementById("level-selector").addEventListener("change",function(){B(o,document.getElementById("level-selector").value)}),document.getElementById("exportStudyListButton").style.display=0<Object.keys(c).length?"inline":"none",document.getElementById("exportStudyListButton").addEventListener("click",function(){let e="data:text/plain;charset=utf-8,";for(var[t,n]of Object.entries(c))e+=[t.replace(";",""),n.en.replace(";","")].join(";"),e+="\n";var l=encodeURI(e),o=document.createElement("a");o.setAttribute("href",l),o.setAttribute("download","hanzi-graph-export-"+Date.now()+".txt"),document.body.appendChild(o),o.click(),document.body.removeChild(o)});var x=function(e,t,n){var l=document.createElement("span");l.className="sentence-container";for(var o=0;o<e.length;o++)!function(e){var t=document.createElement("a");t.textContent=e,t.addEventListener("click",function(){hanzi[e]&&(f(),B(e,document.getElementById("level-selector").value),n||v([e]),h())}),l.appendChild(t)}(e[o]);t.appendChild(l)};document.getElementById("previousHanziButton").addEventListener("click",function(){if(l.length){var e=l.pop(),t=document.getElementById("level-selector").value;B(e.hanzi[0],t);for(var n=1;n<e.hanzi.length;n++)E(e.hanzi[n],t);e.word&&v(e.word),h()}});function w(){z=b=null,document.getElementById("card-answer-container").style.display="none";var e,t,n=0;for([e,t]of Object.entries(c))t.due<=Date.now()&&((!b||b.due>t.due)&&(b=t,z=e),n++);if(document.getElementById("card-due-count").textContent=n,document.getElementById("card-question-container").innerHTML="",0===n)return document.getElementById("task-complete").style.display="inline",document.getElementById("task-description").style.display="none",document.getElementById("show-answer-button").style.display="none",0;document.getElementById("task-complete").style.display="none",document.getElementById("task-description").style.display="inline",document.getElementById("show-answer-button").style.display="block",question=b.zh.join(""),x(question,document.getElementById("card-question-container")),p(document.getElementById("card-question-container"),question),document.getElementById("card-answer").textContent=b.en}var b=null,z=null;document.getElementById("show-answer-button").addEventListener("click",function(){document.getElementById("card-answer-container").style.display="block"}),document.getElementById("wrong-button").addEventListener("click",function(){c[z].nextJump=.5,c[z].due=Date.now()+9e5,localStorage.setItem("studyList",JSON.stringify(c)),w()}),document.getElementById("right-button").addEventListener("click",function(){var e=c[z].nextJump||.5;c[z].nextJump=2*e,c[z].due=Date.now()+24*e*60*60*1e3,localStorage.setItem("studyList",JSON.stringify(c)),w()}),document.getElementById("show-explore").addEventListener("click",function(){document.getElementById("example-container").style.display="block",document.getElementById("study-container").style.display="none",document.getElementById("show-explore").classList.add("active"),document.getElementById("show-study").classList.remove("active"),n=e,h()}),document.getElementById("show-study").addEventListener("click",function(){document.getElementById("example-container").style.display="none",document.getElementById("study-container").style.display="block",document.getElementById("show-study").classList.add("active"),document.getElementById("show-explore").classList.remove("active"),w(),n=a,h()}),document.getElementById("delete-card-button").addEventListener("click",function(){delete c[z],localStorage.setItem("studyList",JSON.stringify(c)),w()}),function(){var e=JSON.parse(sessionStorage.getItem("state"));if(e){document.getElementById("level-selector").value=e.level,B(e.hanzi[0],e.level);for(var t=1;t<e.hanzi.length;t++)E(e.hanzi[t],e.level);e.word&&v(e.word),l=e.undoChain,e.activeTab===a&&document.getElementById("show-study").click(),h()}else{var n=["围","显","故","商","店"];B(n[Math.floor(Math.random()*n.length)],document.getElementById("level-selector").value)}}()}();
